---
title: "Proyecto Final (Diseño Experimental)"
author: "Elaborado por: Andreina Vásquez Castro B27084"
date: "Fecha de ultima modificación `r Sys.Date()`"
output:
 prettydoc::html_pretty:
    theme: cayman
    highlight: github
    math: katex
    toc: true
    collapsed: false
    smooth_scroll: false
    number_sections: true
    fig_width: 7
    fig_height: 6
    fig_caption: true
toc-title: "Tabla de Contenido"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

- Librerías utilizadas:

```{r echo=TRUE, results='hide', message=FALSE, warning=FALSE}
library("psych")
library("tidyverse")
library("gmodels")
library("corrplot")
library("PerformanceAnalytics")
library("kableExtra")
library("tidyr")
library("kableExtra")
library("stats")
library("car")
library("lattice")
library("dplyr")
library("GGally")
```

# Introducción

<div align="justify">


</div>
# Desarrollo

## Carga de los datos

```{r echo=TRUE}
df_uvas <- read.csv("https://raw.githubusercontent.com/Andre9424/Proyecto-final-Lab-de-Proba/main/uvas.csv", header = T, sep=";")
```

## Análisis exploratorio de datos

### Revisión de la estructura del data frame

```{r echo=TRUE}
str(df_uvas)
```

<div align="justify">
Con la función anterior se puede observar que la tabla posee 100 observaciones y cuatro variables ("localidad": Sitio en el que se cultiva la uva, "especie": Color de la uva, "diam": diámetro de la uva y "brix": contenido de azúcar de la uva), la variable "localidad" y "especie" corresponden a variables categóricas, mientras que las variables "diam" y "brix"son númericas. 

</div>

### Verificación de datos nulos

```{r echo=TRUE}
porcentaje_nulo <- df_uvas %>%
  summarise_all(~mean(is.na(.))) * 100
porcentaje_nulo <- porcentaje_nulo %>%
  mutate_all(~paste0(., "%"))

print(porcentaje_nulo)
```
<div align="justify">
Se verificó si existían espacios vacíos o nulos en el data frame y resultó que en cada columna existe un 0% de celdas vacías, así se descarta el sesgo que puede generar esta inconsistencia.

</div>

### Convertir las variables "character" a factor

```{r echo=TRUE}
df_uvas$localidad<-as.factor(df_uvas$localidad)
df_uvas$especie<-as.factor(df_uvas$especie)
class(df_uvas$localidad);class(df_uvas$especie)
```


### Gráfico de distribución de las variables numéricas

<div align="justify">
```{r echo=TRUE, warning=FALSE}

ggplot(df_uvas, aes(x=diam)) +
  geom_histogram(aes(y=..density..), bins=8, fill="#0000CD", alpha=0.7) +
  geom_density(col="red", size=1) +
  labs(title="Distribución del Diámetro", x="Diámetro", y="Densidad")

ggplot(df_uvas, aes(x=brix)) +
  geom_histogram(aes(y=..density..), bins=8, fill="#66CD00", alpha=0.7) +
  geom_density(col="red", size=1) +
  labs(title="Distribución del Brix", x="Brix", y="Densidad")
```

Con base a los gráficos anteriores se puede observar que la variable "diam" posee una distribución aproximadamente normal, centrada alrededor de 1.2, al igual la variable "brix" centrada alrededor de 16.4. 
</div>

### Gráfico de distribución de las variables categóricas

<div align="justify">
```{r echo=TRUE, warning=FALSE}

ggplot(df_uvas, aes(x=localidad)) +
  geom_bar(fill="purple", alpha=0.7) +
  geom_text(stat='count', aes(label=..count..), vjust=-0.5) +
  labs(title="Distribución por Localidad", x="Localidad", y="Cantidad") +
  theme_minimal()

# Gráfico de barras para 'especie' con etiquetas de conteo
ggplot(df_uvas, aes(x=especie)) +
  geom_bar(fill="orange", alpha=0.7) +
  geom_text(stat='count', aes(label=..count..), vjust=-0.5) +
  labs(title="Distribución por Especie", x="Especie", y="Cantidad") +
  theme_minimal()
```


La mayoría de los registros provienen de la localidad "Garita", seguida de "Guácimo" y "San Vito". En cuanto a la especie, la variedad roja es más frecuente que la blanca.

</div>

### Estadísticas del data frame

```{r echo=TRUE}
summary(df_uvas)
```

<div align="justify">
Lo observado en los gráficos se observa también al obtener un resumen de las estadísticas de los datos. Como se observa en los resultados, el diámetro de las uvas varía entre 0.5 y 1.7, con una media de 1.177 y una mediana de 1.20, esto indica una distribución relativamente centrada alrededor de 1.177. El contenido de azúcar ("brix") varía entre 13.80 y 19.30, con una media de 16.38 y una mediana de 16.10, es decir, la mayoría de uvas tienen un contenido de azúcar alrededor de 16.38. 

De los cuantiles se puede deducir que 25% de las observaciones tienen un diámetro menor o igual a 1, el 50% tienen un diámetro menor o igual a 1.2 y el 75% tienen un diámetro menor o igual a 1.4. Por otro lado, el 25% de las observaciones tienen un contenido de azúcar menor o igual a 15.30, el 50% tienen un contenido menor o igual a 16.10 y el 75% tienen un contenido menor o igual a 17.30.

</div>

### Correlación del diámetro con el grado brix

```{r echo=TRUE}
cor.test(x=df_uvas$diam, y=df_uvas$brix, method = "pearson", digits = 3)
```

<div align="justify">
El valor de P es menor a 0.05 indicando que hay evidencia estadística para rechazar la hipotesis nula de que no hay correlación entre el diámetro y el grado brix, a un nivel de significancia de 0.05. Además, el intervalo de confianza del 95% establece que la verdadera correlación esta entre -0.44638 y -0.81987. Por lo que hay una correlación débil pero, a su vez, es estadísticamente significativa, dado que, en promedio, a medida que el diámetro aumenta el contenido de azúcar de la uva disminuye.

</div>

### Gráfico de pares (Combinaciones entre todas las variables)

<div align="justify">
```{r echo=TRUE, results='hide', message=FALSE, warning=FALSE}
ggpairs(df_uvas, lower = list(continuous = "smooth"), diag = list(continuous = "bar"), axisLabels = "none")
```


En el gráfico se muestran distribuciones univariadas en la diagonal, relaciones bivariadas en el parte inferior izquierda y en correlaciones en la parte superior derecha. Sobre las distribuciones univariadas, anteriormente se explicaron, sin embargo, en el gráfico se recalca que en una localidad especifica se producen más uvas y hay mas uvas de un color que de otro. Por otro lado, los diámetros de  las uvas varían, con una tendencia central alrededor de ciertos valores, mientras que el contenido de azucar tambien muestra variablidad. En cuanto a las relaciones bivariadas, la localidad parece tener una influencia en el diámetro y el contenido de azúcar (brix), pues, se observan variaciones en los box plots. La especie también influye en el diámetro y el contenido de azúcar de las uvas, la relación entre el diametro y el contenido de azúcar es negativa y debilmente significativa, como se mencionó anteriormente, ha medida que aumenta el diámetro el contenido de azucar disminuye.
</div>

### Modelo de regresión lineal

```{r echo=TRUE}
mod_lineal <- lm(brix ~ ., data = df_uvas) 
summary(mod_lineal)

```
<div align="justify">
Con base al modelo anterior se deduce lo siguiente:

- Cuando todas las variables independientes son cero, el contenido de azúcar (Brix) se estima en 16.4973.

- En comparación con la localidad de referencia (Garita), las uvas de la Guácima tienen un contenido de azúcar promedio 0.7878 unidades menor, manteniendo constantes las otras variables.

- En comparación con la localidad de referencia (Garita), las uvas de San Vito tienen un contenido de azúcar promedio 1.0766 unidades menor, manteniendo constantes las otras variables.

- En comparación con la especie de referencia (blanca), las uvas rojas tienen un contenido de azúcar promedio 1.3334 unidades mayor, manteniendo constantes las otras variables.

- El diámetro no tiene una relación significativa con el contenido de azúcar (Brix) en este modelo, ya que su valor p es mayor que 0.05.

- R-squared (R²): El valor de 0.3484 indica que aproximadamente el 34.84% de la variabilidad en el contenido de azúcar (Brix) se explica por las variables independientes en el modelo.

- Adjusted R-squared: El valor ajustado de 0.321 ajusta el R² por el número de variables en el modelo y es un poco más conservador.

- F-statistic: La prueba F es significativa (p < 0.05), lo que indica que el modelo en su conjunto es significativo.

En conclusión con lo que se muestra en el modelo de regresión, las uvas de la Guácima y San Vito tienen un contenido de azúcar significativamente menor en comparación con la Garita, las uvas rojas tienen un contenido de azúcar significativamente mayor en comparación con las uvas blancas, no hay una relación significativa entre el diámetro y el contenido de azúcar en este modelo y el modelo explica aproximadamente el 34.84% de la variabilidad en el contenido de azúcar, lo cual es una moderada capacidad explicativa.

Con el resultado anterior se pueden plantear algunas hipótesis con respecto a un problema plantedo basado en las varibles en donde hay una relación significativa.
</div>


## Planteamiento de las hipótesis

<div align="justify">
Se desea determinar si la localidad afecta el grado brix en uvas de las especies rojas y blancas y si el efecto es diferente entre una especie y otra.

- Hipótesis principal de la localidad:

La localidad no tiene un efecto significativo sobre el grado Brix en las uvas:

**H0 = µ(Garita) = µ(Guácima) = µ(SanVito)** 

La localidad tiene un efecto significativo sobre el grado Brix en las uvas:

**H1 = Al menos una de las medias de Brix entre las localidades es diferente.**

- Hipótesis principal de la especie:

La especie no tiene un efecto significativo sobre el grado Brix en las uvas:

**H0 = µ(Blanca) = µ(Roja)**

La especie tiene un efecto significativo sobre el grado Brix en las uvas:

**H1 = Las medias de Brix entre las especies son diferentes.**

- Hipótesis de interacción entre localidad y especie:

No hay interacción significativa entre la localidad y la especie en su efecto sobre el grado Brix en las uvas:

**H0 = Efecto(Blanca) = Efecto(Roja)**

Hay una interacción significativa entre la localidad y la especie en su efecto sobre el grado Brix en las uvas:

**H1 = El efecto de la localidad en el grado Brix depende de la especie.**

</div>

## Análisis ANOVA
<div align="justify">
Antes de realizar el análisis ANOVA se plantearon las siguientes interrogantes:

¿Cuáles son los factores que se incluyeron en el experimento?

¿Cuántos tratamientos tiene el experimento?

¿En qué aspectos se debe concentrar el análisis?

Los factores que se presentan en este experimento son la especie y la localidad, según el análisis exploratorio de los datos hay 3 localidades pero al haber 2 especies las combinaciones entre localidades y especies dan 6 tratamientos posibles. Los aspectos clave del análisis son el efecto principal de la localidad y la especie y la interacción entre la localidad y la especie.
</div>

### Cantidad de tratamientos de las uvas

```{r echo=TRUE}
table(df_uvas$localidad,df_uvas$especie)
```
### Creación del modelo ANOVA

Para el modelo se utiliza la forma de interacción Y~X1*X2.

```{r echo=TRUE}
modelo <- aov(brix ~ localidad * especie, data = df_uvas)
summary(modelo)
```
<div align="justify">

Del análisis anterior se puede observar que hay un efecto significativo de la localidad en el grado Brix de las uvas. Las diferencias entre localidades son lo suficientemente grandes como para ser estadísticamente significativas (p < 0.05). También, Hay un efecto significativo de la especie en el grado Brix de las uvas. Las diferencias entre las especies roja y blanca son estadísticamente significativas (p < 0.05). Por último, hay una interacción significativa entre localidad y especie, lo que significa que el efecto de la localidad en el grado Brix varía según la especie de la uva. Este resultado es importante porque sugiere que no solo los factores individuales afectan el grado Brix, sino también la combinación de ambos.

</div>

### Tabla de efectos

```{r echo=TRUE}
ef <- model.tables(modelo)
ef
```
<div align="justify">

De los efectos anteriores se tiene lo siguiente:

Efecto de la localidad:

- Las uvas de Garita tienen un efecto positivo sobre el grado Brix (0.5773).

- Las uvas de Guácima y Sanvito tienen efectos negativos sobre el grado Brix (-0.274 y -0.4077, respectivamente).

Efecto de la especie:

- Las uvas blancas tienen un efecto negativo sobre el grado Brix (-0.8206).

- Las uvas rojas tienen un efecto positivo sobre el grado Brix (0.5703).

Interacción entre la localidad y la especie:

- En la Garita, las uvas blancas tienen un efecto ligeramente negativo sobre el grado Brix (-0.154), mientras que las uvas rojas tienen un efecto ligeramente positivo (0.112).

- En la Guácima, las uvas blancas tienen un efecto positivo significativo sobre el grado Brix (0.660), mientras que las uvas rojas tienen un efecto negativo significativo (-0.609).

- En Sanvito, las uvas blancas tienen un efecto negativo sobre el grado Brix (-0.420), mientras que las uvas rojas tienen un efecto positivo (0.228).

En conclusion, el efecto principal de la localidad se da que las uvas de la Garita tienden a tener un grado Brix mayor en comparación con la Guácima y San Vito. También se concluye que el efecto de la especie se da en que las uvas rojas tienden a tener un grado Brix mayor que las uvas blancas.Por ultimo se concluye que la interacción muestra que el efecto de la localidad en el grado Brix depende de la especie de uva, por ejemplo, en la Guácima, las uvas blancas tienen un efecto significativo sobre el grado Brix, mientras que las uvas rojas tienen un efecto negativo.

</div>

## Gráficos de los efectos

### Efectos principales de localidad

```{r}
ggplot(df_uvas, aes(x = localidad, y = brix, fill = localidad)) +
  geom_boxplot() +
  labs(title = "Efecto de la Localidad en el Contenido de Azúcar (Brix)",
       x = "Localidad",
       y = "Brix") +
  theme_minimal()
```
<div align="justify">
Conclusiones

- Comparación entre Localidades:

Las uvas de Garita tienen el contenido de azúcar más alto en comparación con Guácima y Sanvito. Las uvas de Guácima y Sanvito tienen un contenido de azúcar similar, pero ambos son menores que Garita.

- Efecto de la Localidad en el Contenido de Azúcar:

La localidad tiene un efecto significativo en el contenido de azúcar (Brix) de las uvas, como se evidenció en el análisis ANOVA y se visualiza en el gráfico de box plot.
</div>

### Efectos principales de especie

```{r echo=TRUE}
ggplot(df_uvas, aes(x = especie, y = brix, fill = especie)) +
  geom_boxplot() +
  labs(title = "Efecto de la Especie en el Contenido de Azúcar (Brix)",
       x = "Especie",
       y = "Brix") +
  theme_minimal()
```
<div align="justify">
Conclusiones

- Comparación entre Especies:

Las uvas de especie roja tienen un contenido de azúcar más alto en comparación con las uvas de especie blanca.
La mediana del contenido de azúcar en las uvas rojas es aproximadamente 1.5 unidades Brix mayor que en las uvas blancas.

- Efecto de la Especie en el Contenido de Azúcar:

La especie tiene un efecto significativo en el contenido de azúcar (Brix) de las uvas, como se evidenció en el análisis ANOVA y se visualiza en el gráfico de box plot.
</div>

### Efectos de interacción entre localidad y grado Brix

```{r echo=TRUE}
xyplot(brix~localidad,groups=especie, pch=18,type=c("p","a"),auto.key=T, data=df_uvas)

```

<div align="justify">
Conclusiones

- Efecto de la Localidad y la Especie:

La localidad afecta el contenido de azúcar de las uvas, y este efecto varía según la especie. Las uvas rojas tienden a tener un mayor contenido de azúcar en comparación con las uvas blancas, pero esta diferencia es más pronunciada en algunas localidades (como Garita) que en otras.

- Interacción Significativa:

La interacción entre localidad y especie es significativa, lo que significa que el efecto de la localidad en el contenido de azúcar no es el mismo para ambas especies de uvas.
Este tipo de interacción es crucial para entender cómo diferentes factores combinados afectan el resultado medido (en este caso, el contenido de azúcar).
</div>

### Efectos de interacción entre localidad y especie

```{r echo=TRUE}
xyplot(brix~especie,groups=localidad, pch=18,type=c("p","a"),auto.key=T, data=df_uvas)

```
<div align="justify">
Conclusiones

- Efecto de la Especie y la Localidad:

La especie de uva afecta significativamente el contenido de azúcar, pero este efecto varía según la localidad.
En general, las uvas rojas tienen un mayor contenido de azúcar en comparación con las uvas blancas, pero esta diferencia es más pronunciada en Garita y Sanvito.

- Interacción Significativa:

La interacción entre especie y localidad es significativa, lo que significa que el efecto de la especie en el contenido de azúcar no es el mismo en todas las localidades.
Esto sugiere que al considerar el contenido de azúcar, es importante tener en cuenta tanto la especie de uva como la localidad de cultivo.
</div>

## Prueba de comparaciones múltiples

```{r echo=TRUE}
tk <- TukeyHSD(modelo)
tk
```

<div align="justify">
Conclusiones

- Efecto de la Localidad:

Las uvas de Garita tienen un contenido de azúcar significativamente mayor en comparación con Guácima y Sanvito.

- Efecto de la Especie:

Las uvas rojas tienen un contenido de azúcar significativamente mayor en comparación con las uvas blancas.

- Interacción entre Localidad y Especie:

Hay diferencias significativas en algunas combinaciones de localidad y especie. Por ejemplo:
Sanvito:blanca tiene un contenido de azúcar significativamente menor que Garita:blanca.
Garita:roja tiene un contenido de azúcar significativamente mayor que Garita:blanca.
</div>

## Pruebas de diagnóstico

### Shapiro

```{r echo=TRUE}
shapiro.test(modelo$residuals)
```

<div align="justify">
En este caso, el valor p es 0.2406, que es mayor que 0.05. Esto significa que no hay suficiente evidencia para rechazar la hipótesis nula. Por lo tanto, podemos concluir que los residuos del modelo no se desvían significativamente de una distribución normal.
La normalidad de los residuos es uno de los supuestos del análisis de varianza (ANOVA). Dado que los residuos son aproximadamente normales, este supuesto del modelo ANOVA se cumple.
</div>

### Gráfico de los residuales

```{r echo=TRUE}
qqPlot(modelo$residuals,
       main = "Q-Q Plot de los Residuos del Modelo",
       ylab = "Residuos",
       xlab = "Cuantiles Teóricos")
```
<div align="justify">
El gráfico Q-Q plot sugiere que los residuos del modelo siguen una distribución aproximadamente normal. La mayoría de los puntos se alinean a lo largo de la línea diagonal y están dentro de las bandas de confianza, confirmando el resultado del test de Shapiro.
</div>

### Bartlett

```{r echo=TRUE}
bartlett.test(brix ~ localidad, data = df_uvas)
bartlett.test(brix ~ especie, data = df_uvas)
```

<div align="justify">
Para la localidad: 

El valor p es 0.2373, que es mayor que el nivel de significancia típico (α=0.05). Por lo tanto, no se puede rechazar la hipótesis nula. Esto indica que no hay evidencia suficiente para afirmar que las varianzas son diferentes entre las localidades.

Para la especie:

El valor p es 0.4557, que es mayor que el nivel de significancia típico (α=0.05). Por lo tanto, no se puede rechazar la hipótesis nula. Esto indica que no hay evidencia suficiente para afirmar que las varianzas son diferentes entre las especies.

Tanto para localidad como para especie, no hay evidencia suficiente para afirmar que las varianzas del contenido de azúcar (Brix) son diferentes entre los grupos. Esto sugiere que se cumple el supuesto de homogeneidad de varianza en el análisis ANOVA.
</div>

# Conclusiones

<div align="justify">
- Las localidades tienen un efecto significativo en el contenido de azúcar de las uvas. Específicamente, las uvas de Garita tienen un contenido de azúcar significativamente mayor en comparación con Guácima y Sanvito.

- Las especies de uvas también afectan significativamente el contenido de azúcar. Las uvas rojas tienen un contenido de azúcar significativamente mayor que las uvas blancas.

- Existe una interacción significativa entre localidad y especie, indicando que el efecto de la localidad en el contenido de azúcar depende de la especie de uva.

- El CME es igual a 1.21, es relativamente bajo, lo que indica que la variabilidad dentro de los grupos es pequeña comparada con la variabilidad total.

- La alta significancia de los CMTrat (localidad: 10.35, especie: 47.30 e interacción: 7.13) en comparación con el CME indica que las diferencias entre los grupos son significativas y altas.

- Dado que los residuos del modelo son aproximadamente normales (como se verificó con el test de Shapiro-Wilk y el Q-Q plot) y que no hay evidencia de heterocedasticidad (como se verificó con el test de Bartlett), se puede considerar que los supuestos del ANOVA se cumplen. Esto respalda la validez de los resultados del análisis ANOVA y las pruebas de realizadas.
</div>

# Bibliografía





